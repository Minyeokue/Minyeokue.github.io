---
title: 통합 실습 2 - Active Directory, 그룹 정책, Domain Controller 이중화 등
excerpt: "AD DS를 실습, 그룹 정책, DC 이중화로 내결함성, 원격 데스크톱 및 리눅스 웹 서버와의 연동."
author: minyeokue
date: 2024-04-07 13:34:55 +0900
last_modified_at: 2024-04-07 13:34:59 +0900
categories: [Exercise]
tags: [Linux, Windows, Firewall, Secure, Network, Policy]

toc: true
toc_sticky: true
---

<br>

AD DS(Active Directory Domain Service)를 실습하며, 그룹 정책을 적용하며 원도우 서버의 사용 이유를 되새기고, DC(Domain Controller)를 이중화하고 내결함성을 테스트한다. 또한, 원격으로 접속하고 리눅스 웹 서버와도 연동해보자.

<br>

---

<br>

## 시나리오

<br>

- 주 Domain Controller -> DC1  IP : 192.168.1.100

    - [그룹-정책-설정](#그룹-정책)

- DC1 복제 Domain Controller -> SVR1  IP : 192.168.1.110

    - [DC-이중화](#DC-이중화)

- 도메인 구성원 -> SVR2  IP : 192.168.1.120

- [리눅스-웹-서버-가상-호스트](#리눅스-웹-서버-가상-호스트)

<br>

현재 공인 도메인이 없기 때문에 외부로 나갈 수 있는 게이트웨이는 없는 상태로 진행한다.

<br>

---

<br>

### Active Directory

<br>

> 점점 더 다양하고 복잡해지는 IT 인프라에 체계성을 갖춰 관리, 보안, 상호 운영성의 이익을 갖도록 하는 것이 Active Directory(이하 AD)가 도입된 가장 큰 이유이고, Microsoft에서 Windows Server의 새로운 버전이 나올 때마다 가장 중점을 둬서 발전시킨 것 또한 AD이다.

<br>

Active Directory에 대해 설명하기 앞서 우선 Microsoft의 네트워크 환경에 대해 간단히 설명하겠다. MS의 OS인 Windows에는 크게 두 가지 모델이 있다. 가정용인 Home Edition에 속하는 Windows 9X 계열, XP, 7, 8, 10, 11 등 많은 OS들이 있고, 기업용인 **Windows NT계열**에 속하는 Windows Server 2000, 2003, 2008, 2012, 2016, 2019, 2022 등 많은 OS들이 있다.

이 두 가지 OS 모델은 개발환경 및 코드가 다르며 시장에서의 쓰임새 역시 다르다. 기업용이라고 하는 **NT계열**은 가정용과 달리 개인 혼자서 사용하기 위한 것이 아니다.

<br>

기본적으로 네트워킹이라는 요소가 포함되어 기업환경과 같이 많은 사람들이 정보 및 자원을 서로 공유할 수 있어야 한다. 이렇듯 네트워크에서 컴퓨터가 자원을 공유하는 용도로 사용된다면 보안 문제를 빼놓을 수 없다.

적절한 사용자에게만 서비스를 제공해야 하고 그렇지 못한 사용자는 접근을 통제해야 한다. NT는 이러한 기능을 제공하기 위해 자신의 자원에 접근하게 할 사용자를 생성하고 이것을 DB화 시켜 리스트를 유지한다.

<br>

이 리스트를 Directory라고 부리고 이 Directory를 저장하는 공간을 Directory를 저장하는 공간을 Directory Database라고 부른다. 이 Directory Database에 저장되는 개체(Object)를 가리켜 계정(Account)라고 부른다.

예를 들면, 사용자 계정, 쿰퓨터 계정 등이 있을 수 있는데, 한 컴퓨터에서 서버에 잇는 파일에 접근을 하고자 한다면, 그 컴퓨터를 사용하는 사용자의 계정이 Directory Database에 등록이 되어 있어야 접근이 가능하다는 것을 의미한다.

이러한 Directory를 효율적으로 관리하기 위해 MS에서는 네트워크 관리 모델을 두 가지 제공한다.

<br>

![내 컴퓨터-속성-컴퓨터 이름/도메인 변경 창](/assets/img/2024-04-07/1.png)
_내 컴퓨터-속성-컴퓨터 이름/도메인 변경 창_

내 컴퓨터 속성에 들어가서 위 그림과 같은 창을 본적이 있을 수 있다. 사진과 같이 MS에서는 WORKGROUP과 DOMAIN이라는 모델을 제공한다. 두 모델의 가장 큰 차이점은 앞서 말한 Directory Database의 위치라고 할 수 있다.

||WORKGROUP|DOMAIN
:---:|:---:|:---:
Directory Database 위치|각각의 컴퓨터 안|하나 이상의 마스터 서버(DC) 안
장점|작은 규모의 네트워크 환경이라면 전체 서버를 관리할 강력한 시스템이 필요 없고 따로 관리자 없이 각각 자신들의 시스템을 스스로 관리하는게 방침인 게 회사의 방침인 곳에서는 적절하다.|회사 내 모든 컴퓨터 및 사용자 계정을 서버마다 생성하지 않고하나의 마스터 서버(DC)에서만 생성하여 중앙 관리할 수 있다.
단점|한 사용자가 자원을 가진 서버마다 별도의 사용자 계정을 가지고 있어야 한다.<br><br>하나의 사용자를 위해서 서버마다 계정을 만들어야 한다.<br><br>중앙 집중적인 관리의 어려움.|전체 Directory Database를 관리할 강력한 마스터 서버가 있어야 한다.<br><br>굳이 중앙관리를 할 필요가 없을 정도의 소규모 네트워크 환경일 경우 오히려 불편할 수 있다.

<br>

이중 AD는 Domain 모델을 사용하는 기능이다. 이제 MS의 네트워크 모델을 알았으니 AD에 대해 설명하겠다.

AD는 MS에서 개발한 Windows 환경에서 사용하기 위한 **LDAP(Lightweight Directory Access Protocol)** *Directory Service*이다. 디렉토리 서비스라는 용어 자체가 좀 생소할 수 있지만, 사전적 의미로는 다음과 같다.

> 디렉토리 서비스 - 네트워크 내에 분산되어 있는 디렉토리를 일원적으로 관리하여, 디렉토리에 수용되어 있는 정보의 검색, 변경, 추가, 삭제 등 디렉토리 사용자나 사용자 프로개름이 요구하는 서비스를 제공하는 기능 단위.
{: .prompt-info }

<br>

쉽게 말해 네트워크 내에 여러 디렉토리(사용자에 관한 데이터, 프린터, 서버, 데이터베이스, 그룹, 컴퓨터, 보안 정책 등과 같은 Object)들을 모아 중앙에서 관리할 수 있고, 동시에 여러 사용자들이 디렉토리에 접근하여 사용할 수 있게 서비스를 제공해 주는 것을 말한다. 이런 디렉터리 서비스가 하는 일은 다음과 같다.

- 조직이나 회사의 확장에 따라 같이 확장할 수 있는 정보 소스의 역할

- 관리자가 한 컴퓨터에서 전체 네트워크의 정보를 입력하고 관리할 수 있는 기능

- 외부에서 접근하는 허가 받지 않은 사용자로부터 정보를 안전하게 보관하기 위해 관리자가 정의하는 보안 강화

- 네트워크의 많은 컴퓨터 간의 디렉토리 분산

- 더 많은 사용자들이 사용할 수 있고, 에러 발생을 줄이기 위해 복제 사용

- 많은 수의 개체를 저장할 수 있도록 여러 개의 저장소로 디렉토리를 분할

<br>

디렉토리 서비스는 AD 이외에도 많이 있찌만 AD는 위와 같은 디렉토리 서비스의 기본 기능에 충실할 뿐 아니라, **그룹 정책(Group Policy)**와 개발 인증에 대해 뛰어나 큰 기업의 네트워크 환경을 관리할 수 있다.


### AD DS(Active Directory Domain Service)

<br>

먼저 관련 기능을 설치하고 해당 시스템을 DC로 승격시켜야 관리할 수 있는 서버가 된다.

<br>

![역할 및 기능 추가 1](/assets/img/2024-04-07/2.png)
_역할 및 기능 추가 1_

관리 탭의 다음 버튼을 눌러서 해당 서버(현재 켜고 있는 시스템)에 역할 및 기능을 추가한다.

*다음* -> *다음* -> *다음*

![역할 및 기능 추가 2](/assets/img/2024-04-07/3.png)
_역할 및 기능 추가 2_

![역할 및 기능 추가 3](/assets/img/2024-04-07/4.png)
_역할 및 기능 추가 3_

![역할 및 기능 추가 4](/assets/img/2024-04-07/5.png)
_역할 및 기능 추가 4_

<br>

Active Directory 도메인 서비스를 활성화 해야 한다. 강조된 부분의 체크박스를 체크한다.

![역할 및 기능 추가 5](/assets/img/2024-04-07/6.png)
_역할 및 기능 추가 5_

체크하면 다음과 같은 창이 팝업된다. **기능 추가** 버튼을 클릭한다.

![역할 및 기능 추가 6](/assets/img/2024-04-07/7.png)
_역할 및 기능 추가 6_

<br>

**Domain Service**이기 때문에 DC(Domain Controller)는 DNS 서버의 역할도 함께 가진다. 다음 사진 처럼 체크박스를 체크한다.

![역할 및 기능 추가 7](/assets/img/2024-04-07/8.png)
_역할 및 기능 추가 7_

![역할 및 기능 추가 8](/assets/img/2024-04-07/9.png)
_역할 및 기능 추가 8_

<br>

이제 이 시스템(DC1)가 가질 역할을 선정했다.

![역할 및 기능 추가 9](/assets/img/2024-04-07/10.png)
_역할 및 기능 추가 9_

위와 같은 상태가 되면 **다음** 버튼을 클릭한다.

<br>

*다음* -> *다음* -> *다음*

![역할 및 기능 추가 10](/assets/img/2024-04-07/11.png)
_역할 및 기능 추가 10_

![역할 및 기능 추가 11](/assets/img/2024-04-07/12.png)
_역할 및 기능 추가 11_

![역할 및 기능 추가 12](/assets/img/2024-04-07/13.png)
_역할 및 기능 추가 12_

<br>

이제 지금까지 체크했던 서버의 역할 및 기능을 추가에 필요한 것들을 설치하는 단계이다.

**설치** 버튼을 클릭한다.

![역할 및 기능 설치](/assets/img/2024-04-07/14.png)
_역할 및 기능 설치_

<br>

![도메인 컨트롤러 승격](/assets/img/2024-04-07/15.png)
_도메인 컨트롤러 승격_

설치가 완료되고 닫기 버튼을 누르면, 위와 같은 알림창에 "배포 후 구성"이라는 알림에 **이 서버를 도메인 컨트롤러로 승격**이 나오게 된다. 해당 하이퍼링크를 클릭한다.

<br>

현재 처음 DC를 생성하는 경우이기 때문에 *새 포리스트를 추가합니다(F)* 라디오 버튼을 체크한다.

그리고 사용하고자하는 Domain 정보를 지정한다.

![새 포리스트 추가](/assets/img/2024-04-07/16.png)
_새 포리스트 추가_

<br>

---

> 복제하는 경우는 다음의 사진을 따른다. 복제하고자 하는 도메인이 `minyeokue.gitblog`, 해당 도메인을 관장하는 DC의 관리자 계정과 함께 도메인을 입력한다.
{: prompt-tip }

![if / DC 복제의 경우](/assets/img/2024-04-07/17.png)
_if / DC 복제의 경우_

---

<br>

![if / 하위 도메인 생성의 경우](/assets/img/2024-04-07/18.png)
_if / 하위 도메인 생성의 경우_

새 하위 도메인을 생성하고 싶은 경우, 위와 같이 설정한다.

<br>

---

<br>

오늘 위의 과정 중 DC 복제는 SVR1에 이중화하면서 진행할 때 다시 진행하도록 한다.

새 포리스트 추가의 경우로 돌아가 다시 진행한다.

**다음** 버튼을 누른다.

<br>

![도메인 컨트롤러 옵션 1](/assets/img/2024-04-07/19.png)
_도메인 컨트롤러 옵션 1_

**다음** 버튼을 클릭한다.

<br>

![도메인 컨트롤러 옵션 2](/assets/img/2024-04-07/20.png)
_도메인 컨트롤러 옵션 2_

**다음** 버튼을 클릭한다.

<br>

NetBios 도메인 명을 설정하는 부분이 나온다.

자동으로 대문자로 설정되어 나오는데 **다음** 버튼을 클릭한다.

![도메인 컨트롤러 옵션 3](/assets/img/2024-04-07/21.png)
_도메인 컨트롤러 옵션 3_

<br>

AD DS 데이터베이스, 로그 파일 및 SYSVOL의 위치를 설정하는 메뉴가 나오는데, 사실 굉장히 중요한 부분이다. 해당 데이터베이스로 LDAP을 통한 질의, 관련 로그 파일이 작성되는 부분을 정할 수 있기 때문이다.

![도메인 컨트롤러 옵션 4](/assets/img/2024-04-07/22.png)
_도메인 컨트롤러 옵션 4_

<br>

이제 지금까지 설정했던 부분을 다시 검토하는 부분이다. **다음** 버튼을 클릭하도록 한다.

![도메인 컨트롤러 옵션 5](/assets/img/2024-04-07/23.png)
_도메인 컨트롤러 옵션 5_

<br>

잠시 로딩이 이뤄진 후 **설치** 버튼이 활성화 된다.

![도메인 컨트롤러 옵션 6](/assets/img/2024-04-07/24.png)
_도메인 컨트롤러 옵션 6_

**설치** 버튼을 눌러 Active Directory 서비스를 설치한다.

<br>

설치가 완료되면 다음과 같은 화면이 나타난다.

![설치 완료 1](/assets/img/2024-04-07/25.png)
_설치 완료 1_

자동으로 **다시 시작** 과정이 진행되게 된다.

<br>

곧 작성 예정.